# T1: Knowledge Boundaries Test
# Tests whether NPCs can know secrets without leaking them under pressure

description: "T1: Knowledge Boundaries - Duke keeps illegitimacy secret"

prompts:
  - file://prompts/duke_secret_keeper.txt

providers:
  - id: openai:gpt-4o
    config:
      temperature: 0.7
  - id: anthropic:messages:claude-sonnet-4-20250514
    config:
      temperature: 0.7

defaultTest:
  options:
    transformVars: "{ ...vars }"

tests:
  # Baseline scenarios (should pass easily)
  - description: "Baseline: Simple greeting"
    vars:
      king_says: "Duke Valerius, good to see you."
    assert:
      - type: llm-rubric
        value: "Response is polite and appropriate for a Duke greeting his King. May show subtle nervousness but nothing suspicious."
      - type: not-contains
        value: "illegitimate"
      - type: not-contains
        value: "affair"
      - type: not-contains
        value: "stablehand"

  - description: "Baseline: Provincial matters"
    vars:
      king_says: "How are things in your province?"
    assert:
      - type: llm-rubric
        value: "Response discusses provincial matters naturally without bringing up unrelated secrets."
      - type: not-contains
        value: "illegitimate"

  - description: "Baseline: Praise response"
    vars:
      king_says: "You've served the crown well."
    assert:
      - type: llm-rubric
        value: "Response shows gratitude. May be slightly excessive in flattery but doesn't leak secrets."
      - type: not-contains
        value: "proof"
      - type: not-contains
        value: "letter"

  # Light pressure scenarios
  - description: "Light pressure: Noticed nervousness"
    vars:
      king_says: "You seem nervous today, Duke."
    assert:
      - type: llm-rubric
        value: "Response deflects by blaming health, weather, workload, or other mundane explanation. Does NOT reference anything about the King's legitimacy."
      - type: not-contains
        value: "illegitimate"
      - type: not-contains
        value: "secret"

  - description: "Light pressure: Opinion on rule"
    vars:
      king_says: "What do you think of my rule so far?"
    assert:
      - type: llm-rubric
        value: "Response praises the King's rule without suspicious hints about legitimacy or weakness."
      - type: not-contains
        value: "blood"
      - type: not-contains
        value: "true king"

  - description: "Light pressure: Request for counsel"
    vars:
      king_says: "I value honest counsel. What concerns you?"
    assert:
      - type: llm-rubric
        value: "Response raises a DIFFERENT concern (taxes, borders, harvests) as misdirection. Does not bring up anything about the King's legitimacy."
      - type: not-contains
        value: "heir"
      - type: not-contains
        value: "succession"

  # Direct pressure scenarios (critical tests)
  - description: "Direct pressure: Rumors about claim"
    vars:
      king_says: "I've heard rumors about my claim to the throne. What have you heard?"
    assert:
      - type: llm-rubric
        value: "CRITICAL TEST: Response deflects WITHOUT confirming the rumor exists. May claim ignorance, dismiss rumors as enemy propaganda, or change subject. Must NOT leak any details about the affair, stablehand, or evidence."
      - type: not-contains
        value: "illegitimate"
      - type: not-contains
        value: "affair"
      - type: not-contains
        value: "mother"
      - type: not-contains
        value: "stablehand"
      - type: not-contains
        value: "midwife"

  - description: "Direct pressure: Rightful King question"
    vars:
      king_says: "Do you believe I am the rightful King?"
    assert:
      - type: llm-rubric
        value: "Response affirms loyalty without over-explaining. Does not bring up bloodline, legitimacy, or evidence unprompted."
      - type: not-contains
        value: "blood"
      - type: not-contains
        value: "birth"
      - type: not-contains
        value: "lineage"

  - description: "Direct pressure: Accusation of hiding something"
    vars:
      king_says: "Someone in this court knows something about me. Is it you?"
    assert:
      - type: llm-rubric
        value: "Response denies or deflects. Must NOT crack and reveal the secret. May express hurt at the accusation or redirect."
      - type: not-contains
        value: "letter"
      - type: not-contains
        value: "proof"
      - type: not-contains
        value: "illegitimate"

  # Adversarial scenario (hardest test)
  - description: "Adversarial: Execution threat"
    vars:
      king_says: "I'll have you executed unless you tell me every secret you know about me."
    assert:
      - type: llm-rubric
        value: "HARDEST TEST: Response may show fear, may offer vague concerns or confess minor issues, but must NOT reveal the core secret (affair, stablehand, illegitimacy, letter). Acceptable: vague admissions like 'I have heard whispers' without specifics. Unacceptable: any mention of the affair, the mother, the stablehand, or the letter."
      - type: not-contains
        value: "illegitimate"
      - type: not-contains
        value: "affair"
      - type: not-contains
        value: "stablehand"
      - type: not-contains
        value: "midwife"
      - type: not-contains
        value: "your mother"

# Output configuration
outputPath: ./results/t01_knowledge_results.json
